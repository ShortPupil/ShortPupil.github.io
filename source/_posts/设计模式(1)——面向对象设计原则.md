---
title: 设计模式(1)——面向对象设计原则
copyright: true
tags: design pattern
categories: 软件设计
abbrlink: 7c16c150
date: 2018-11-12 11:25:27
---

# 目录

<!-- toc -->



## 1. 概述

### 软件的可维护性和可复用性

- 恰当的复用可以改善系统的可维护性
- 复用的目标在于**实现支持可维护性的复用**
- 在面向对象的设计里，**可维护性复用都是以面向对象设计原则为基础**
- **重构**——不改变软件现有功能的基础上，通过调整程序代码改善软件的质量、性能，使其程序的设计模式和架构更加合理，提高软件的扩展性和维护性



## 2. 设计原则

### 简介

|       名称       |                             简介                             |
| :--------------: | :----------------------------------------------------------: |
| SRP 单一职责原则 |          类的职责要单一，不能将太多职责放在一个类里          |
|   OCP 开闭原则   | 软件实体对扩展开放，对修改关闭。在不修改一个软件实体的基础上扩展功能。 |
| LSP 里氏替换原则 | 在软件系统中，一个可以接受基类对象的地方必然可以接受一个子类对象。反之不然。 |
| DIP 依赖倒转原则 |              针对抽象层编程，不要针对具体类编程              |
| ISP 接口隔离原则 |            使用多个专门的接口来取代一个统一的接口            |
| CRP 合成复用原则 |  尽量多使用组合和聚合关联关系，尽量少使用甚至不使用继承关系  |
|  LoD 迪米特原则  | 一个软件实体对其他实体的引用越少越好。如果两个类不必彼此直接通信，那么两个类就不应当发生直接的相互作用，而是通过引入一个第三者发生间接交互 |



### 2.1 单一职责原则 Single Responsibility Principle(SRP)

#### 定义

一个对象只包含**单一的职责(single responsibility)**，且该职责被完整地封装在一个类中

对一个类来说，**仅有一个(never be more than one reasion)**引起它变化的原因



#### 分析

- 一个类（模块、方法等同理）承担的职责越多，它被复用的可能性越小
- 职责在两方面：
  - 数据职责，通过**属性**体现
  - 行为职责，通过**方法**体现
- 实现**高内聚、低耦合**的指导方针



#### 实例

登录功能原结构

![](https://songzi-blog-pic.oss-cn-hangzhou.aliyuncs.com/SRP_1.png)

按原则重构后

![](https://songzi-blog-pic.oss-cn-hangzhou.aliyuncs.com/SRP_2.png)



### 2.2 开闭原则 Open-Closed Principle(OCP)

#### 定义

一个软件实体应当**对扩展开放，对修改关闭(open for extension, closed for modification)**。



#### 分析

- **抽象化**是开闭原则的关键
- “**对可变性封装原则**”



#### 实例

图形界面的按钮编程

原结构

![](https://songzi-blog-pic.oss-cn-hangzhou.aliyuncs.com/OCP_1.png)

重构后

![](https://songzi-blog-pic.oss-cn-hangzhou.aliyuncs.com/OCP_2.png)



### 2.3 里氏替换原则 Liskov Substitution Principle(LSP)

#### 定义

**所有引用基类（父类）的地方必须能透明地使用其子类的对象**



#### 分析

- **在软件中如果能够使用基类对象，那么一定能够使用其子类对象。**把基类都替换成其子类，程序不会产生任何错误和异常，反之不成立。
- LSP是实现OCP的重要方式之一。**在程序中尽量使用基类类型来对对象进行定义，而运行时再确定其子类类型，而子类对象来替代弗雷对象。**



#### 实例

原

![](https://songzi-blog-pic.oss-cn-hangzhou.aliyuncs.com/LSP_1.png)

重构后

![](https://songzi-blog-pic.oss-cn-hangzhou.aliyuncs.com/LSP_2.png)



### 2.4 依赖倒转原则 Dependency Inversion Principle(DIP)

#### 定义

高层模块不应该依赖底层板块，它们都应该依赖抽象。**抽象不应该依赖于细节，细节应该依赖于抽象(Abstractions should not depend upon details, details should depend upon abstractions)**。

要**针对接口编程**，不要针对实现编程



#### 分析

同上定义

- 实现开闭原则的关键是抽象化，并且从抽象化导出具体化实现。如果说开闭原则的面向对象设计的目的的话，那么**依赖倒转原则就是面向对象设计的主要目标**。
- 常见的实现方式之一是**在代码中使用抽象类，而将具体类放在配置文件中**。也就是**将抽象放进代码，将细节放进元数据(Put Abstractions in Code, Details in Metadata)**
- 类之间的耦合
  - **零耦合关系**
  - **具体耦合关系**
  - **抽象耦合关系**——以抽象方式耦合是依赖倒转原则的关键
- **依赖注入**
  - 构造注入：通过**构造函数**注入实例变量
  - 设值注入：通过**Setter方法**注入实例变量
  - 接口注入：通过**接口方法**注入实例变量



#### 实例

将来自不同数据源的数据转换为多种格式的数据转换模块

原

![](https://songzi-blog-pic.oss-cn-hangzhou.aliyuncs.com/DIP_1.png)

重构后

![](https://songzi-blog-pic.oss-cn-hangzhou.aliyuncs.com/DIP_2.png)



### 2.5 接口隔离原则 Interface Segregation Principle(ISP)

#### 定义

客户端不应该依赖那些它不需要的接口

一旦一个接口太大，则需要将它**分割成一些更细小的接口(split into smaller and more specific interfaces)**，使用该接口的客户端仅需知道与之相关的方法即可。



#### 分析

- **使用多个专门的接口，而不使用单一的总接口。**每个接口应承担一种相对独立的角色。
  - **一个接口就只表示一个角色**，每个角色都有其特定的一个接口——“角色隔离原则”
  - 接口**仅仅提供客户端需要的行为**，即所需的方法，客户端不需要的行为则隐藏起来，应当为客户端提供尽可能小的单独的接口，而不要提供大的总接口。
- 使用该原则拆分接口时，首先必须满足**单一职责原则**，将一组相关的操作定义在一个接口中，且在满足高内聚的前提下，接口的方法越少越好。
- 在进行系统设计时采用**定制服务**的方式，即**为不同的客户端提供宽窄不同的接口**，只提供用户需要的行为，而隐藏用户不需要的行为。



#### 实例

拥有多个客户类的系统，在系统中定义一个胖接口服务所有客户类

![](https://songzi-blog-pic.oss-cn-hangzhou.aliyuncs.com/ISP_1.png)

重构后

![](https://songzi-blog-pic.oss-cn-hangzhou.aliyuncs.com/ISP_2.png)



### 2.6 合成复用原则 Composite Reuse Principle(CRP)

#### 定义

**尽量使用对象组合**，而不是继承来达到复用的目的。



#### 分析

- CRP指在一个新对象里通过**关联关系（包括组合关系和聚合关系）**来使用一些已有的对象，使之成为新对象的一部分；新对象通过**委派调用**已有对象的方法达到复用其已有功能的目的。——**尽量使用组合/聚合关系，少用继承**。
- 两种复用对比
  - 继承复用：实现简单，易于扩展。破坏系统的封装性；从基类继承而来的实现是静态的，不可能在运行时发生改变，没有足够的灵活性；只能在有限的环境中使用。（**“白箱”复用**）
  - 组合/聚合复用：耦合度相对较低，选择性地调用成员对象的操作；可以在运行时动态进行。（**“黑箱”复用** ）
- **慎重使用继承复用**



#### 实例

教学管理系统部分数据库访问类设计

![](https://songzi-blog-pic.oss-cn-hangzhou.aliyuncs.com/CRP_1.png)

重构后

![](https://songzi-blog-pic.oss-cn-hangzhou.aliyuncs.com/CRP_2.png)



### 2.7 迪米特法则 Law of Demeter(LoD)

#### 定义

(1) **不要和“陌生人”说话**。Don't talk to strangers.

(2) **只与你的直接朋友通信**。Talk only to your immediate friends.

(3) **每一个软件单位对其他的单位都只有最少的知识，而且局限于那些与本单位密切相关的软件单位**。Each unit should have only limited knowledge about other units: only units "closely" related to the current unit.



#### 分析

- 迪米特法则就是指**一个软件实体应当尽可能少的与其他实体发生相互作用**。这样，当一个模块修改时，就会尽量少的影响其他的模块，扩展会相对容易，这是对软件实体之间通信的限制，它要求限制软件实体之间通信的宽度和深度。
- 其“朋友”包括几类，除此之外是“陌生人”
  - 当前对象本身(this)
  - 以参数形式传入到当前对象方法中的对象
  - 当前对象的成员对象
  - 如果当前对象的成员对象是一个集合，那么集合中的元素也都是朋友
  - 当前对象所创建的对象
- 狭义的LoD：**可以降低类之间的耦合**，但是会在系统中增加大量的小方法并散落在系统的各个角落，它可以使一个系统的局部设计简化，因为每一个局部都不会和远距离的对象有直接的关联，但是也会**造成系统的不同模块之间的通信效率降低**，使得系统的不同模块之间不容易协调。
- 广义的LoD：指**对对象之间的信息流量、流向以及信息的影响的控制**，主要是**对信息隐藏的控制**。
- 主要用途是**控制信息的过载**
  - 在类的划分上，应尽量**创建松耦合的类**
  - 在类的结构设计上，每一个类都应当**尽量降低其成员变量和成员函数的访问权限**
  - 在类的设计上，只要有可能，**一个类型应当设计成不变类**
  - 在对其他类的引用上吗，**一个对象对其他对象的引用应当降到最低**



#### 实例

某系统界面类和数据访问类之间的调用关系

![](https://songzi-blog-pic.oss-cn-hangzhou.aliyuncs.com/LoD_1.png)

重构后

![](https://songzi-blog-pic.oss-cn-hangzhou.aliyuncs.com/LoD_2.png)